---
keywords: fastai
description: What is underneath the Neural Networks?
title: Writing a simple NN
toc: false 
badges: true
comments: true
categories: [jupyter, posts]
image: images/nn/relu.png
nb_path: _notebooks/2020-11-20-write-a-simple-nn-nb.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-11-20-write-a-simple-nn-nb.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Goal">Goal<a class="anchor-link" href="#Goal"> </a></h2><p>Understand the workings of an NN(heavily modified/reproduced from <a href="https://github.com/fastai/fastbook/blob/master/04_mnist_basics.ipynb">fastbook notbook</a>)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Concrete-Problem-and-Plan">Concrete Problem and Plan<a class="anchor-link" href="#Concrete-Problem-and-Plan"> </a></h2><p>Recognize 3's and 7's from mnist dataset using the following methods:</p>
<ul>
<li>Start with a baseline </li>
<li>Write a Linear NN </li>
<li>Write a Linear NN using pytorch functions (nn)</li>
<li>Write a Linear NN using fastai functions</li>
<li>Write a non-linear NN </li>
<li>Write a non-linear NN using pytorch</li>
<li>Write a non-linear NN using fastai</li>
<li>Write a (DEEPER 18 layer) non-linear NN using fastai</li>
<li>compare all answers for epochs, lr and accuracy</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Results-upfront">Results upfront<a class="anchor-link" href="#Results-upfront"> </a></h2><table>
<thead><tr>
<th style="text-align:left">Method</th>
<th>Epochs</th>
<th style="text-align:left">Accuracy</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Baseline</td>
<td>NA</td>
<td style="text-align:left">96.6%</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">Own Linear NN</td>
<td>20</td>
<td style="text-align:left">96.5%</td>
<td>Uses slightly different initial values than the rest</td>
</tr>
<tr>
<td style="text-align:left">Linear NN with own SGD</td>
<td>20</td>
<td style="text-align:left">98%</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">Linear NN with SGD</td>
<td>20</td>
<td style="text-align:left">98%</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">Linear NN with fastai</td>
<td>20</td>
<td style="text-align:left">98%</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">Own Non-Linear NN</td>
<td>20</td>
<td style="text-align:left">98%</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">CNN 18 layer</td>
<td>1</td>
<td style="text-align:left">99.7%</td>
<td></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Gathering-the-Tensors">Gathering the Tensors<a class="anchor-link" href="#Gathering-the-Tensors"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Stack tensors with list comprehension</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">stack_tensors</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
    <span class="n">lcomp_tensors</span> <span class="o">=</span> <span class="p">[</span><span class="n">tensor</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">o</span><span class="p">))</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span>
    <span class="nb">print</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lcomp_tensors</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">lcomp_tensors</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">/</span><span class="mi">255</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stacked_threes_tr</span> <span class="o">=</span> <span class="n">stack_tensors</span><span class="p">(</span><span class="n">threes_tr</span><span class="p">)</span>
<span class="n">stacked_threes_vd</span> <span class="o">=</span> <span class="n">stack_tensors</span><span class="p">(</span><span class="n">threes_vd</span><span class="p">)</span>
<span class="n">stacked_sevens_tr</span> <span class="o">=</span> <span class="n">stack_tensors</span><span class="p">(</span><span class="n">sevens_tr</span><span class="p">)</span>
<span class="n">stacked_sevens_vd</span> <span class="o">=</span> <span class="n">stack_tensors</span><span class="p">(</span><span class="n">sevens_vd</span><span class="p">)</span>

<span class="n">stacked_threes_tr</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>6131
1010
6265
1028
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([6131, 28, 28])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Baseline">Baseline<a class="anchor-link" href="#Baseline"> </a></h2><ul>
<li>Get mean of <code>3</code> and <code>7</code> tensors per pixel across all images</li>
<li>check for each picture if the dstance (l1_norm or l2_norm) is closer to <code>3</code> or <code>7</code>.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Mean of stacked tensors</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mean_3_2d</span> <span class="o">=</span> <span class="n">stacked_threes_tr</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="mi">0</span><span class="p">))</span>
<span class="n">mean_7_2d</span> <span class="o">=</span> <span class="n">stacked_sevens_tr</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="mi">0</span><span class="p">))</span>
<span class="n">show_image</span><span class="p">(</span><span class="n">mean_3_2d</span><span class="p">),</span> <span class="n">show_image</span><span class="p">(</span><span class="n">stacked_threes_tr</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(&lt;AxesSubplot:&gt;, &lt;AxesSubplot:&gt;)</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Distance measurement</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">l1_norm</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span> <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">l2_norm</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span> <span class="k">return</span> <span class="p">((</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span>
<span class="c1"># F.l1_loss(a_3.float(),mean7), F.mse_loss(a_3,mean7).sqrt() #pytorch functions</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Is a tensor a <code>3</code> or <code>7</code>?</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">is_3</span><span class="p">(</span><span class="n">stacked_tensor</span><span class="p">,</span><span class="n">mean_3</span><span class="p">,</span><span class="n">mean_7</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">l2_norm</span><span class="p">(</span><span class="n">stacked_tensor</span><span class="p">,</span> <span class="n">mean_3</span><span class="p">)</span><span class="o">&lt;</span><span class="n">l2_norm</span><span class="p">(</span><span class="n">stacked_tensor</span><span class="p">,</span><span class="n">mean_7</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Checking the accuracy</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">accuracy_3s_1</span> <span class="o">=</span> <span class="n">is_3</span><span class="p">(</span><span class="n">stacked_threes_vd</span><span class="p">,</span><span class="n">mean_3_2d</span><span class="p">,</span><span class="n">mean_7_2d</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">accuracy_3s_2</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">is_3</span><span class="p">(</span><span class="n">stacked_sevens_vd</span><span class="p">,</span><span class="n">mean_3_2d</span><span class="p">,</span><span class="n">mean_7_2d</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy of prediction is: &quot;</span><span class="p">,(</span><span class="n">accuracy_3s_1</span><span class="o">+</span><span class="n">accuracy_3s_2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="c1">## no need to do 7 separately</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Accuracy of prediction is:  tensor(0.9661)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Result</strong>: 97% Accuracy.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Write-your-own-Linear-NN">Write your own Linear NN<a class="anchor-link" href="#Write-your-own-Linear-NN"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_svg output_subarea output_execute_result">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.42.3 (20191010.1750)
 -->
<!-- Title: G Pages: 1 -->
<svg width="661pt" height="78pt"
 viewBox="0.00 0.00 660.87 78.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 74)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-74 656.87,-74 656.87,4 -4,4"/>
<!-- init -->
<g id="node1" class="node">
<title>init</title>
<ellipse fill="none" stroke="black" cx="27" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="27" y="-14.3" font-family="Times,serif" font-size="14.00">init</text>
</g>
<!-- predict -->
<g id="node2" class="node">
<title>predict</title>
<ellipse fill="none" stroke="black" cx="135.2" cy="-18" rx="44.39" ry="18"/>
<text text-anchor="middle" x="135.2" y="-14.3" font-family="Times,serif" font-size="14.00">predict</text>
</g>
<!-- init&#45;&gt;predict -->
<g id="edge1" class="edge">
<title>init&#45;&gt;predict</title>
<path fill="none" stroke="black" d="M54.25,-18C62.37,-18 71.63,-18 80.89,-18"/>
<polygon fill="black" stroke="black" points="80.89,-21.5 90.89,-18 80.89,-14.5 80.89,-21.5"/>
</g>
<!-- loss -->
<g id="node3" class="node">
<title>loss</title>
<ellipse fill="none" stroke="black" cx="244.99" cy="-52" rx="28.7" ry="18"/>
<text text-anchor="middle" x="244.99" y="-48.3" font-family="Times,serif" font-size="14.00">loss</text>
</g>
<!-- predict&#45;&gt;loss -->
<g id="edge2" class="edge">
<title>predict&#45;&gt;loss</title>
<path fill="none" stroke="black" d="M170.6,-28.85C183.05,-32.78 197.09,-37.21 209.54,-41.14"/>
<polygon fill="black" stroke="black" points="208.53,-44.49 219.12,-44.16 210.64,-37.81 208.53,-44.49"/>
</g>
<!-- gradient -->
<g id="node4" class="node">
<title>gradient</title>
<ellipse fill="none" stroke="black" cx="406.63" cy="-52" rx="50.09" ry="18"/>
<text text-anchor="middle" x="406.63" y="-48.3" font-family="Times,serif" font-size="14.00">gradient</text>
</g>
<!-- loss&#45;&gt;gradient -->
<g id="edge3" class="edge">
<title>loss&#45;&gt;gradient</title>
<path fill="none" stroke="black" d="M273.8,-52C293.82,-52 321.57,-52 346.45,-52"/>
<polygon fill="black" stroke="black" points="346.55,-55.5 356.55,-52 346.55,-48.5 346.55,-55.5"/>
</g>
<!-- step -->
<g id="node5" class="node">
<title>step</title>
<ellipse fill="none" stroke="black" cx="524.23" cy="-18" rx="30.59" ry="18"/>
<text text-anchor="middle" x="524.23" y="-14.3" font-family="Times,serif" font-size="14.00">step</text>
</g>
<!-- gradient&#45;&gt;step -->
<g id="edge4" class="edge">
<title>gradient&#45;&gt;step</title>
<path fill="none" stroke="black" d="M445.8,-40.77C459.01,-36.89 473.76,-32.55 486.82,-28.71"/>
<polygon fill="black" stroke="black" points="487.82,-32.06 496.43,-25.88 485.85,-25.35 487.82,-32.06"/>
</g>
<!-- step&#45;&gt;predict -->
<g id="edge6" class="edge">
<title>step&#45;&gt;predict</title>
<path fill="none" stroke="black" d="M493.68,-18C428.65,-18 272.39,-18 189.67,-18"/>
<polygon fill="black" stroke="black" points="189.47,-14.5 179.47,-18 189.47,-21.5 189.47,-14.5"/>
<text text-anchor="middle" x="315.09" y="-21.8" font-family="Times,serif" font-size="14.00">repeat</text>
</g>
<!-- stop -->
<g id="node6" class="node">
<title>stop</title>
<ellipse fill="none" stroke="black" cx="622.32" cy="-18" rx="30.59" ry="18"/>
<text text-anchor="middle" x="622.32" y="-14.3" font-family="Times,serif" font-size="14.00">stop</text>
</g>
<!-- step&#45;&gt;stop -->
<g id="edge5" class="edge">
<title>step&#45;&gt;stop</title>
<path fill="none" stroke="black" d="M554.84,-18C563.24,-18 572.53,-18 581.44,-18"/>
<polygon fill="black" stroke="black" points="581.64,-21.5 591.64,-18 581.64,-14.5 581.64,-21.5"/>
</g>
</g>
</svg>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Steps</strong></p>
<ol>
<li>initialize parameters (<code>w,b</code>)</li>
<li>Predicit with training vectors (<code>X@w + b</code>)</li>
<li>Calculate the loss (something that varies with tiny variation of parameters)</li>
<li>Calculate the gradient at parameter values (<code>params.grad</code>)</li>
<li>Make a step based on the gradient (<code>w -= gradient(w) * lr</code>)</li>
<li>Repeat n times!</li>
<li>Calculate Validation accuracy (No. of predictions matching Targets)</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Squeeze into tuple</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dset</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span><span class="n">train_y</span><span class="p">))</span>
<span class="n">valid_dset</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">valid_x</span><span class="p">,</span><span class="n">valid_y</span><span class="p">))</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dset</span><span class="p">),</span><span class="nb">type</span><span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(torch.Size([784]), tensor([1]), 12396, tuple)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Using Data Loaders to load into batches</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dl</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span><span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">dl_vd</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">valid_dset</span><span class="p">,</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span><span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
<span class="c1"># Not sure why True Shuffle is not working even on the validation set. Somehow it gets shuffled wrong</span>

<span class="n">xb</span><span class="p">,</span><span class="n">yb</span> <span class="o">=</span> <span class="n">first</span><span class="p">(</span><span class="n">dl_vd</span><span class="p">)</span>
<span class="n">xb</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">yb</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(torch.Size([256, 784]), torch.Size([256, 1]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Step 1</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">init_params</span><span class="p">()</span> <span class="p">:</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">)</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Step 2</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">linear1</span><span class="p">(</span><span class="n">tens</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tens</span><span class="nd">@w</span><span class="o">+</span><span class="n">b</span>   
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Step 3</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">mnist_loss</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span><span class="n">target</span><span class="p">):</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">prediction</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">target</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">prediction</span><span class="p">,</span><span class="n">prediction</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="c1">## Check what happenes if you use sum (guess: nothing different)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Step 4</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">calc_grad</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span><span class="n">yb</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">xb</span><span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">mnist_loss</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">yb</span><span class="p">)</span>
    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Step 1-5</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">train_epoch</span><span class="p">(</span><span class="n">dl</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">params</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">xb</span><span class="p">,</span><span class="n">yb</span> <span class="ow">in</span> <span class="n">dl</span><span class="p">:</span>
        <span class="n">calc_grad</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span><span class="n">yb</span><span class="p">,</span><span class="n">model</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="c1"># print(b,params[1])</span>
            <span class="n">p</span><span class="o">.</span><span class="n">data</span><span class="o">-=</span> <span class="n">p</span><span class="o">.</span><span class="n">grad</span><span class="o">*</span><span class="n">lr</span>
            <span class="c1"># print(b,params[1])</span>
            <span class="n">p</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">zero_</span><span class="p">()</span>
            <span class="c1">## p.data is needed otherwise get leaf-variable error</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Step 7</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">batch_accuracy</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span> <span class="n">yb</span><span class="p">):</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">xb</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">()</span>
    <span class="n">correct</span> <span class="o">=</span> <span class="p">(</span><span class="n">preds</span><span class="o">&gt;</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">==</span> <span class="n">yb</span>
    <span class="k">return</span> <span class="n">correct</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">validate_epoch</span><span class="p">(</span><span class="n">dl</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
    <span class="n">accs</span> <span class="o">=</span> <span class="p">[</span><span class="n">batch_accuracy</span><span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="n">xb</span><span class="p">),</span><span class="n">yb</span><span class="p">)</span> <span class="k">for</span> <span class="n">xb</span><span class="p">,</span><span class="n">yb</span> <span class="ow">in</span> <span class="n">dl</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">accs</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="mi">4</span><span class="p">)</span>

    
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Setting parameters</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lr</span><span class="o">=</span><span class="mi">1</span>
<span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">w</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">init_params</span><span class="p">()</span>
<span class="n">params</span><span class="o">=</span><span class="n">w</span><span class="p">,</span><span class="n">b</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>torch.Size([784]) torch.Size([1]) tensor([-0.0198], requires_grad=True)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Training</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">train_epoch</span><span class="p">(</span><span class="n">dl</span><span class="p">,</span> <span class="n">linear1</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">validate_epoch</span><span class="p">(</span><span class="n">dl_vd</span><span class="p">,</span> <span class="n">linear1</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0.4932 0.8298 0.8219 0.8996 0.9232 0.9344 0.9432 0.9489 0.9537 0.9551 0.957 0.9585 0.9614 0.9619 0.9633 0.9643 0.9648 0.9648 0.9657 0.9657 </pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Result</strong>: 96 percent with 20 epochs</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Doing-it-with-own-BASIC-OPTIM">Doing it with own BASIC OPTIM<a class="anchor-link" href="#Doing-it-with-own-BASIC-OPTIM"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>SGD</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">BasicOptim</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">lr</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">params</span><span class="p">),</span><span class="n">lr</span>
        
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">data</span> <span class="o">-=</span> <span class="n">p</span><span class="o">.</span><span class="n">grad</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lr</span>
            
    <span class="k">def</span> <span class="nf">zero_grad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">grad</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># p.grad.zero_() also OK.</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">train_epoch</span><span class="p">(</span><span class="n">dl</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">xb</span><span class="p">,</span><span class="n">yb</span> <span class="ow">in</span> <span class="n">dl</span><span class="p">:</span>
        <span class="n">calc_grad</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span><span class="n">yb</span><span class="p">,</span><span class="n">model</span><span class="p">)</span>
        <span class="n">opt</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">opt</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">train_model</span><span class="p">(</span><span class="n">dl</span><span class="p">,</span><span class="n">model</span><span class="p">,</span> <span class="n">no_epochs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_epochs</span><span class="p">):</span>
        <span class="n">train_epoch</span><span class="p">(</span><span class="n">dl</span><span class="p">,</span><span class="n">model</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">validate_epoch</span><span class="p">(</span><span class="n">dl_vd</span><span class="p">,</span><span class="n">linear2</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Setting parameters</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lr</span><span class="o">=</span><span class="mi">1</span>
<span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">linear2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">opt</span> <span class="o">=</span> <span class="n">BasicOptim</span><span class="p">(</span><span class="n">linear2</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span><span class="n">lr</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_model</span><span class="p">(</span><span class="n">dl</span><span class="p">,</span> <span class="n">linear2</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0.4932 0.8843 0.814 0.9087 0.9336 0.9463 0.9555 0.9614 0.9663 0.9673 0.9697 0.9712 0.9741 0.9751 0.9761 0.977 0.9775 0.9775 0.9785 0.9785 </pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Result</strong>: 98% with 20 epochs</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Linear-NN-with-built-in-SGD">Linear NN with built in SGD<a class="anchor-link" href="#Linear-NN-with-built-in-SGD"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">train_model</span><span class="p">(</span><span class="n">dl</span><span class="p">,</span><span class="n">model</span><span class="p">,</span> <span class="n">no_epochs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_epochs</span><span class="p">):</span>
        <span class="n">train_epoch</span><span class="p">(</span><span class="n">dl</span><span class="p">,</span><span class="n">model</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">validate_epoch</span><span class="p">(</span><span class="n">dl_vd</span><span class="p">,</span><span class="n">linear2</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Setting parameters</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lr</span><span class="o">=</span><span class="mi">1</span>
<span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">linear2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">opt</span> <span class="o">=</span> <span class="n">BasicOptim</span><span class="p">(</span><span class="n">linear2</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span><span class="n">lr</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_model</span><span class="p">(</span><span class="n">dl</span><span class="p">,</span> <span class="n">linear2</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0.4932 0.8843 0.814 0.9087 0.9336 0.9463 0.9555 0.9614 0.9663 0.9673 0.9697 0.9712 0.9741 0.9751 0.9761 0.977 0.9775 0.9775 0.9785 0.9785 </pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Result</strong>: 98% with 20 epochs</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Linear-NN-with-fastai">Linear NN with fastai<a class="anchor-link" href="#Linear-NN-with-fastai"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Everything in 3 lines</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span> <span class="o">=</span> <span class="n">DataLoaders</span><span class="p">(</span><span class="n">dl</span><span class="p">,</span><span class="n">dl_vd</span><span class="p">)</span>

<span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">opt_func</span><span class="o">=</span><span class="n">SGD</span><span class="p">,</span> <span class="n">loss_func</span><span class="o">=</span><span class="n">mnist_loss</span><span class="p">,</span><span class="n">metrics</span><span class="o">=</span><span class="n">batch_accuracy</span><span class="p">)</span>

<span class="n">learn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">)</span> <span class="c1">## part which is a for loop of training and validating</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>batch_accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.637098</td>
      <td>0.503163</td>
      <td>0.495584</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.439934</td>
      <td>0.228752</td>
      <td>0.797350</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.164458</td>
      <td>0.165872</td>
      <td>0.850343</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.073856</td>
      <td>0.101805</td>
      <td>0.916094</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.040425</td>
      <td>0.075480</td>
      <td>0.933759</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.027307</td>
      <td>0.060971</td>
      <td>0.948479</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.021858</td>
      <td>0.051846</td>
      <td>0.957311</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.019390</td>
      <td>0.045741</td>
      <td>0.962709</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.018109</td>
      <td>0.041433</td>
      <td>0.965653</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.017324</td>
      <td>0.038244</td>
      <td>0.967125</td>
      <td>00:00</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Result</strong>: 97% with 10 epochs</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Adding-a-nonlinearity">Adding a nonlinearity<a class="anchor-link" href="#Adding-a-nonlinearity"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Non-linear NN with RELU (Rectified Linear Unit)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">simple_net</span><span class="p">(</span><span class="n">xb</span><span class="p">):</span> 
    <span class="n">res</span> <span class="o">=</span> <span class="n">xb</span><span class="nd">@w1</span> <span class="o">+</span> <span class="n">b1</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="nd">@w2</span> <span class="o">+</span> <span class="n">b2</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Initializing parameters</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">init_params2</span><span class="p">(</span><span class="n">size</span><span class="p">):</span> <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">w1</span> <span class="o">=</span> <span class="n">init_params2</span><span class="p">((</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span>
<span class="n">b1</span> <span class="o">=</span> <span class="n">init_params2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">w2</span> <span class="o">=</span> <span class="n">init_params2</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="n">b2</span> <span class="o">=</span> <span class="n">init_params2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/opt/conda/envs/fastai/lib/python3.8/site-packages/fastbook/__init__.py:55: UserWarning: Not providing a value for linspace&#39;s steps is deprecated and will throw a runtime error in a future release. This warning will appear only once per process. (Triggered internally at  /pytorch/aten/src/ATen/native/RangeFactories.cpp:23.)
  x = torch.linspace(min,max)
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Non-linear NN with pytorch</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">simple_net2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn2</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">simple_net2</span><span class="p">,</span><span class="n">opt_func</span><span class="o">=</span><span class="n">SGD</span><span class="p">,</span> <span class="n">loss_func</span><span class="o">=</span><span class="n">mnist_loss</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">batch_accuracy</span><span class="p">)</span>

<span class="n">learn2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>batch_accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.333909</td>
      <td>0.405487</td>
      <td>0.504416</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.153576</td>
      <td>0.240681</td>
      <td>0.790481</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.083833</td>
      <td>0.117808</td>
      <td>0.913150</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.054202</td>
      <td>0.078306</td>
      <td>0.941609</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.040586</td>
      <td>0.060718</td>
      <td>0.957311</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.033723</td>
      <td>0.050975</td>
      <td>0.964181</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.029842</td>
      <td>0.044882</td>
      <td>0.966143</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.027354</td>
      <td>0.040743</td>
      <td>0.968597</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.025581</td>
      <td>0.037743</td>
      <td>0.969578</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.024215</td>
      <td>0.035456</td>
      <td>0.970069</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.023111</td>
      <td>0.033643</td>
      <td>0.972031</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.022192</td>
      <td>0.032156</td>
      <td>0.972522</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>12</td>
      <td>0.021408</td>
      <td>0.030907</td>
      <td>0.974975</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>13</td>
      <td>0.020730</td>
      <td>0.029837</td>
      <td>0.975957</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>14</td>
      <td>0.020136</td>
      <td>0.028907</td>
      <td>0.975957</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>15</td>
      <td>0.019609</td>
      <td>0.028090</td>
      <td>0.977429</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>16</td>
      <td>0.019138</td>
      <td>0.027364</td>
      <td>0.977920</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>17</td>
      <td>0.018714</td>
      <td>0.026714</td>
      <td>0.977920</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>18</td>
      <td>0.018328</td>
      <td>0.026129</td>
      <td>0.978410</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>19</td>
      <td>0.017974</td>
      <td>0.025598</td>
      <td>0.978901</td>
      <td>00:00</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="CNN-with-18-layers-with-fastai">CNN with 18 layers with fastai<a class="anchor-link" href="#CNN-with-18-layers-with-fastai"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>18 layer model #resnet18</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span> <span class="o">=</span> <span class="n">ImageDataLoaders</span><span class="o">.</span><span class="n">from_folder</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">cnn_learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">resnet18</span><span class="p">,</span> <span class="n">pretrained</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">loss_func</span><span class="o">=</span><span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.068580</td>
      <td>0.012664</td>
      <td>0.995584</td>
      <td>00:08</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Result</strong>: 99.7% with 1 epoch</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Results">Results<a class="anchor-link" href="#Results"> </a></h2><table>
<thead><tr>
<th>Method</th>
<th>Epochs</th>
<th>Accuracy</th>
<th>comment</th>
</tr>
</thead>
<tbody>
<tr>
<td>Baseline</td>
<td>NA</td>
<td>96.6%</td>
<td></td>
</tr>
<tr>
<td>Own Linear NN</td>
<td>20</td>
<td>96.5%</td>
<td>Uses different initial values than the rest</td>
</tr>
<tr>
<td>Linear NN with own SGD</td>
<td>20</td>
<td>98%</td>
<td></td>
</tr>
<tr>
<td>Linear NN with SGD</td>
<td>20</td>
<td>98%</td>
<td></td>
</tr>
<tr>
<td>Linear NN with fastai</td>
<td>20</td>
<td>98%</td>
<td></td>
</tr>
<tr>
<td>Own Non-Linear NN</td>
<td>20</td>
<td>98%</td>
<td></td>
</tr>
<tr>
<td>CNN 18 layer</td>
<td>1</td>
<td>99.7%</td>
<td></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
 

